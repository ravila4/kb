<h1 id="systemd">Systemd<a aria-hidden="true" class="anchor-heading icon-link" href="#systemd"></a></h1>
<p>Knowing systemd is useful for automating many tasks in Linux.</p>
<h2 id="running-services-as-user">Running Services as User<a aria-hidden="true" class="anchor-heading icon-link" href="#running-services-as-user"></a></h2>
<p>Running services as a user instead of root is beneficial in many cases.</p>
<p>For example, we may want to run Music Player Daemon (mpd) on startup as a user in order to use user configuration files instead of the global ones. In this case, we must first disable the default service, and re-enable it as user:</p>
<pre><code>systemctl stop mpd.service
systemctl disable mpd.service
systemctl --user enable mpd.service
</code></pre>
<h2 id="creating-systemd-services">Creating Systemd Services<a aria-hidden="true" class="anchor-heading icon-link" href="#creating-systemd-services"></a></h2>
<p>User services are stored under: <code>~/.config/systemd/user/</code>. Place any custom scripts that you write in this folder.</p>
<p>Here is an example change-GTK-theme.service, which changes my computer's GTK theme to dark mode:</p>
<pre class="language-systemd"><code class="language-systemd"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Change the GTK theme to dark mode.</span>
<span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">graphical.target</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">oneshot</span>
<span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/bin/sh -c 'gsettings set org.gnome.desktop.interface gtk-theme Adwaita-dark &#x26;&#x26; gsettings set org.gnome.gedit.preferences.editor scheme builder-dark'</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">default.target</span>
</code></pre>
<h2 id="scheduling-systemd-tasks">Scheduling Systemd Tasks<a aria-hidden="true" class="anchor-heading icon-link" href="#scheduling-systemd-tasks"></a></h2>
<p>Systemd can be used as a more powerful alternative to cron bs.</p>
<p>To do this, you need to create two files:  <code>my-service.service</code>, and a <code>my-service.timer</code>, both files must have the same root name.</p>
<p>Example timer file:</p>
<pre class="language-systemd"><code class="language-systemd"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Change the GTK theme daily at a given time.</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Timer</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">OnCalendar</span><span class="token punctuation">=</span><span class="token value attr-value">*-*-* 16:00:00</span>
<span class="token key attr-name">Persistent</span><span class="token punctuation">=</span><span class="token value attr-value"><span class="token boolean">true</span></span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">timers.target</span>
</code></pre>
<p>This timer runs the change-GTK.service shown previously every day at 16:00 hrs.</p>
<p>For more on timers: <a href="https://wiki.archlinux.org/index.php/Systemd/Timers">https://wiki.archlinux.org/index.php/Systemd/Timers</a></p>
<h2 id="viewing-systemd-logs">Viewing Systemd Logs<a aria-hidden="true" class="anchor-heading icon-link" href="#viewing-systemd-logs"></a></h2>
<p>You can use journalctl to view logs from systemd.</p>
<pre class="language-bash"><code class="language-bash">journalctl -u my-service.service
</code></pre>
<p>Some useful commands:</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># Show of the last 10 lines of a log every second</span>
<span class="token function">watch</span> -n <span class="token number">1</span> journalctl -u myservice.service -n <span class="token number">10</span> --no-pager

<span class="token comment"># Follow the log. Similar to above, but keeps all new history</span>
journalctl -f -u myservice.service

<span class="token comment"># See all logs from the last hour</span>
journalctl -u myservice.service --no-pager --since<span class="token operator">=</span><span class="token string">"1 hour ago"</span>

<span class="token comment"># Bonus: colorize the output using ccze</span>
journalctl -f -u myservice.service <span class="token operator">|</span> ccze -o nolookups
</code></pre>